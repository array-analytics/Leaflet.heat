"use strict";function simpleheat(t){if(!(this instanceof simpleheat))return new simpleheat(t);this._canvas=t="string"==typeof t?document.getElementById(t):t,this._ctx=t.getContext("2d"),this._width=t.width,this._height=t.height,this._max=1,this._data=[]}"undefined"!=typeof module&&(module.exports=simpleheat),simpleheat.prototype={defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},data:function(t){return this._data=t,this},max:function(t){return this._max=t,this},add:function(t){return this._data.push(t),this},clear:function(){return this._data=[],this},radius:function(t,i){i=void 0===i?15:i;var a=this._circle=this._createCanvas(),e=a.getContext("2d"),s=this._r=t+i;return a.width=a.height=2*s,e.shadowOffsetX=e.shadowOffsetY=2*s,e.shadowBlur=i,e.shadowColor="black",e.beginPath(),e.arc(-s,-s,t,0,2*Math.PI,!0),e.closePath(),e.fill(),this},resize:function(){this._width=this._canvas.width,this._height=this._canvas.height},gradient:function(t){var i=this._createCanvas(),a=i.getContext("2d"),e=a.createLinearGradient(0,0,0,256);for(var s in i.width=1,i.height=256,t)e.addColorStop(+s,t[s]);return a.fillStyle=e,a.fillRect(0,0,1,256),this._grad=a.getImageData(0,0,1,256).data,this},draw:function(t){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var i=this._ctx;i.clearRect(0,0,this._width,this._height);for(var a,e=0,s=this._data.length;e<s;e++)a=this._data[e],i.globalAlpha=Math.max(a[2]/this._max,void 0===t?.05:t),i.drawImage(this._circle,a[0]-this._r,a[1]-this._r);var n=i.getImageData(0,0,this._width,this._height);return this._colorize(n.data,this._grad),i.putImageData(n,0,0),this},_colorize:function(t,i){for(var a,e=0,s=t.length;e<s;e+=4)(a=4*t[e+3])&&(t[e]=i[a],t[e+1]=i[a+1],t[e+2]=i[a+2])},_createCanvas:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}},function(t){if("function"==typeof define&&define.amd)define(["leaflet"],t);else if("undefined"!=typeof module)module.exports=t(require("leaflet"));else{if(void 0===this.L)throw new Error("Leaflet must be loaded first!");t(this.L)}}(function(t){return t.HeatLayer=(t.Layer?t.Layer:t.Class).extend({initialize:function(i,a){this._latlngs=i,t.setOptions(this,a)},setLatLngs:function(t){return this._latlngs=t,this.redraw()},addLatLng:function(t){return this._latlngs.push(t),this.redraw()},setOptions:function(i){return t.setOptions(this,i),this._heat&&this._updateOptions(),this.redraw()},redraw:function(){return this._heat&&!this._frame&&this._map&&!this._map._animating&&(this._frame=t.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(i){this._map=i,this._canvas||this._initCanvas(),this.options.pane?this.getPane().appendChild(this._canvas):i._panes.overlayPane.appendChild(this._canvas),i.on("moveend",this._reset,this),i.options.zoomAnimation&&t.Browser.any3d&&i.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){this.options.pane?this.getPane().removeChild(this._canvas):t.getPanes().overlayPane.removeChild(this._canvas),t.off("moveend",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},_initCanvas:function(){var i=this._canvas=t.DomUtil.create("canvas","leaflet-heatmap-layer leaflet-layer"),a=t.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);i.style[a]="50% 50%";var e=this._map.getSize();i.width=e.x,i.height=e.y;var s=this._map.options.zoomAnimation&&t.Browser.any3d;t.DomUtil.addClass(i,"leaflet-zoom-"+(s?"animated":"hide")),this._heat=simpleheat(i),this._updateOptions()},_updateOptions:function(){this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur),this.options.gradient&&this._heat.gradient(this.options.gradient),this.options.max&&this._heat.max(this.options.max)},_reset:function(){var i=this._map.containerPointToLayerPoint([0,0]);t.DomUtil.setPosition(this._canvas,i);var a=this._map.getSize();this._heat._width!==a.x&&(this._canvas.width=this._heat._width=a.x),this._heat._height!==a.y&&(this._canvas.height=this._heat._height=a.y),this._redraw()},_redraw:function(){if(this._map){var i,a,e,s,n,h,o,r,d,l=[],_=this._heat._r,m=this._map.getSize(),f=new t.Bounds(t.point([-_,-_]),m.add([_,_])),u=void 0===this.options.max?1:this.options.max,c=void 0===this.options.maxZoom?this._map.getMaxZoom():this.options.maxZoom,p=1/Math.pow(2,Math.max(0,Math.min(c-this._map.getZoom(),12))),g=_/2,v=[],w=this._map._getMapPanePos(),y=w.x%g,x=w.y%g;for(i=0,a=this._latlngs.length;i<a;i++){if(e=this._map.latLngToContainerPoint(this._latlngs[i]),f.contains(e))n=Math.floor((e.x-y)/g)+2,h=Math.floor((e.y-x)/g)+2,d=(void 0!==this._latlngs[i].alt?this._latlngs[i].alt:void 0!==this._latlngs[i][2]?+this._latlngs[i][2]:1)*p,v[h]=v[h]||[],(s=v[h][n])?(s[0]=(s[0]*s[2]+e.x*d)/(s[2]+d),s[1]=(s[1]*s[2]+e.y*d)/(s[2]+d),s[2]+=d):v[h][n]=[e.x,e.y,d]}for(i=0,a=v.length;i<a;i++)if(v[i])for(o=0,r=v[i].length;o<r;o++)(s=v[i][o])&&l.push([Math.round(s[0]),Math.round(s[1]),Math.min(s[2],u)]);this._heat.data(l).draw(this.options.minOpacity),this._frame=null}},_animateZoom:function(i){var a=this._map.getZoomScale(i.zoom),e=this._map._getCenterOffset(i.center)._multiplyBy(-a).subtract(this._map._getMapPanePos());t.DomUtil.setTransform?t.DomUtil.setTransform(this._canvas,e,a):this._canvas.style[t.DomUtil.TRANSFORM]=t.DomUtil.getTranslateString(e)+" scale("+a+")"}}),t.heatLayer=function(i,a){return new t.HeatLayer(i,a)},t.heatLayer});